import { CommandManager } from '../command/command.manager';
import { GroupView } from './group.view';
import { modelFactory } from '../test/model.factory';
import { GridService } from '../services/grid';
import { Disposable } from '../infrastructure/disposable';

describe('Group View', () => {
	let node;
	let table = {
		data: {
			columns: () =>
				[{
					key: 'id', type: null
				}]
		}
	};
	let model = modelFactory();
	let gridService = new GridService(model);
	let commandManager = new CommandManager();
	const basket = new Disposable();
	const { shortcut } = model.action();
	const navShortcut = {
		register: commands => {
			basket.using(shortcut.register(commandManager, commands));
		},
		keyCode: () => shortcut.keyCode
	};
	let groupView = new GroupView(model, table, gridService, navShortcut);

	beforeEach('reset node', () => {
		node = {
			children: [1,2,3,4,5],
			state: {
				expand: true
			},
			level: 2,
			key: 'name',
			type: 'group'
		};
	});

	describe('toggleStatus', () => {
		it('execute() should toggle node.state', () => {
			let command = groupView.toggleStatus;
			command.execute(node);
			let result = groupView.status(node);
			expect(result).to.equal('collapse');
			command.execute(node);
			result = groupView.status(node);
			expect(result).to.equal('expand');
		});

		it('should return true if canExecute', () => {
			let command = groupView.toggleStatus;
			let result = command.canExecute(node);
			expect(result).to.equal(true);
		});

		it('should return false if can`tExecute', () => {
			delete node.type;
			let command = groupView.toggleStatus;
			let result = command.canExecute(node);
			expect(result).to.equal(false);
		});
	});

	describe('count', () => {
		it('should return length of node.children or node.rows', () => {
			let result = groupView.count(node);
			expect(result).to.equal(5);
		});
	});

	describe('status', () => {
		it('should return status', () => {
			let result = groupView.status(node);
			expect(result).to.equal('expand');
		});
	});

	describe('offset', () => {
		it('should return offset', () => {
			const column = {
				key: 'id',
				offset: 24
			};
			let table = {
				data: {
					columns: () => [column]
				}
			};
			let gridService = new GridService(model);
			let groupView = new GroupView(model, table, gridService, navShortcut);
			let result = groupView.offset(node, column);
			expect(result).to.equal(48); // model.offset = 24(optional value) * node.level = 2 == 48
		});
	});
});
